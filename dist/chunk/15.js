(window.webpackJsonp=window.webpackJsonp||[]).push([[15,16,51],{"221":function(e,t,n){"use strict";n.r(t);var a=n(134),c=n(143),i=(n(191),n(136));t.default=function(e){var t=e.field,n=e.isDisable,l=e.placeholder,r=e.onChange,s=e.onBlur;return Object(i.jsx)(c.r,Object(a.a)(Object(a.a)({},e),{},{"value":e.value||void 0,"className":"field","clearable":!0,"placeholder":l,"disabled":n,"onChange":function onChange(e){return r&&r(e)},"onBlur":function onBlur(e){return s&&s(e.target.value)},"maxLength":t.length||255}))}},"222":function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));var a=n(134),c=n(18),i=n(20),l=n(476),r=n(891),s=n(220),o=n(140),u=n(172),d=n(136),f={"labelCol":{"span":9},"wrapperCol":{"span":15}},BaseSection_FormItem=function(e){var t=Object(i.useContext)(q),n=t.data,c=t.refForm,r=t.setSections,s=t.module,m=e.field,b=e.options,O=e.section,p=function gethigherrole(e){u.a.get("/crm/v2/functions/gethigherrole/actions/execute",{"auth_type":"oauth","roleName":e}).then((function(e){if(e&&"success"===e.code){var t=e.details,n={"name":"Region","value":JSON.parse(t.output).name};n.value&&c.setFields([n])}}))},h=function getDepartment(e,t){u.a.get("/crm/v2/functions/getDepartment/actions/execute",{"auth_type":"oauth","roleName":t,"id":e}).then((function(e){if(e&&"success"===e.code){var t=e.details,n={"name":"Account_Department","value":t.output};n.value&&c.setFields([n]);var a={"name":"Public_Lead","value":t.output};a.value&&c.setFields([a])}}))};return Object(d.jsx)(o.e,{"className":"form-item","children":Object(d.jsx)(l.a.Item,Object(a.a)(Object(a.a)(Object(a.a)({"className":"form-item-label","label":null,"name":m.api_name,"rules":[{"required":m.required,"message":m.field_label+"不能为空"}],"tooltip":!(!m.is_show_tip||"icon"!==m.tip_type)&&m.hint,"initialValue":n[m.api_name]||m.default_value},f),b),{},{"children":Object(d.jsx)(j,{"onSelect":function onSelect(e){if(null!=e&&e.maps&&null!=e&&e.maps.length&&null!=e&&e.maps[0].pick_list_values){var t=null==e?void 0:e.maps[0].pick_list_values,n={};n.name=null==e?void 0:e.maps[0].api_name,t.length&&(n.value=t[0].display_value),c.setFields([n]),r((function(n){return n.map((function(n){n.id===O.id&&n.fields.map((function(n){n.api_name===(null==e?void 0:e.maps[0].api_name)&&(n.maps=t)}))})),n}))}if(null!=e&&e.role&&"Leads"===s){if(-1!==(null==e?void 0:e.role.name.indexOf("战区"))){var a={"name":"War_Zone","value":null==e?void 0:e.role.name};c.setFields([a])}p(e.role.name),h(e.role.id,e.role.name)}},"field":m})}))})},j=function FormItem(e){var t=e.isDisable,n=e.field;return Object(d.jsxs)(o.e,{"id":n.api_name,"className":"formItem space-between","children":[Object(d.jsxs)("span",{"className":t?"label disable":"label","onClick":function onClick(){return console.log(n)},"children":[Object(d.jsx)("span",{"className":"required","children":n.required?"*":""}),n.field_label]}),Object(d.jsx)(o.e,{"className":t?"element disable":"element","children":Object(d.jsx)(s.a,Object(a.a)({},e))})]})},m=n(275),b=n(143),BaseSection=function(e){var t=e.section,n=(e.form,e.data.id?t.fields:t.fields.filter((function(e){return"Owner"!==e.api_name}))),a=Object(i.useState)("1"),l=Object(c.a)(a,2),r=l[0],s=l[1];return Object(d.jsx)(o.e,{"className":"baseSectiosContent","children":n.length?Object(d.jsx)(b.g,{"className":"collapse-content","activeKey":[r],"children":Object(d.jsx)(b.g.Panel,{"className":"title-content","onClick":function onClick(){s(r?"":"1"),console.log("section",t)},"title":t.display_label,"children":Object(d.jsxs)(o.e,{"className":"collapse-panel-content","children":[n.map((function(e){return Object(d.jsx)(BaseSection_FormItem,{"field":e,"section":t},e.id)})),Object(d.jsx)(o.e,{"className":"buttomBtn","onClick":function onClick(){return s("")},"children":Object(d.jsxs)(b.b,{"className":"buttomBtnText","children":["收起",t.display_label,Object(d.jsx)(m.a,{})]})})]})},"1")}):null})},O=n(14),p=n(900),h=n(901),x=n(467),v=n(276),_=n(157),g=n.n(_),y=n(16),C=n(22),k=n(154),components_FormItem=function(e){var t=Object(i.useContext)(q),n=t.data,c=t.refForm,r=t.overloadData,s=t.setOverloadData,u=t.fieldMapDependencies,f=t.actionMap,j=t.setDefaultRelationField,m=t.executeFormula,b=t.executeLinkageFunction,O=t.executeSumField,p=t.setDisableEdit,h=t.customModule,x=t.executeEventFunction,v=e.record,_=e.field,F=e.section,w=e.index,S=(F&&F.fields[0].fields||[]).filter((function(e){return-1!==e.view.indexOf(n.id?"edit":"new")})),D=F&&F.fields[0].name,L=function setRelatedSelectField(e){var t=(u||[]).filter((function(e){return e.parent_field_id===_.id}))[0];if(t){var n=_.choices.filter((function(t){return t.label===e}))[0],i=e&&n&&n.id,l=S.filter((function(e){return e.id===t.sub_field_id}))[0];if(l){var o,d=[],f=i&&t.field_map_dependency_items.filter((function(e){return e.parent_value===i}))[0];f&&l.choices.forEach((function(e){-1!==f.sub_values.indexOf(e.id)&&d.push(e)}));var j=c.getFieldValue([D,w,l.name]);j&&0===d.filter((function(e){return e.label===j})).length&&c.setFields([{"name":[D,w,l.name],"value":null}]);var m=Object(a.a)({},r);m[D]||(m[D]=[]),(o=m[D])[w]||(o[w]={}),m[D][w][l.name]={"choices":d},s(m)}}},P=function setRelatedResourceField(e){var t=(u||[]).filter((function(e){return e.parent_field_id===_.id}))[0];if(t){var n=S.filter((function(e){return e.id===t.sub_field_id}))[0];if(n){var i,l={};t.related_field_name&&(l["".concat(t.related_field_name,"_eq")]=e&&e.id||0),n.related_field_search_condition&&0!==Object.values(n.related_field_search_condition)[0]&&c.setFields([{"name":[D,w,n.name],"value":null}]);var o=Object(a.a)({},r);o[D]||(o[D]=[]),(i=o[D])[w]||(i[w]={}),o[D][w][n.name]={"related_field_search_condition":l},s(o)}}},B=function(){var e=Object(C.a)(Object(y.a)().mark((function _callee(e){return Object(y.a)().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!h["".concat(D,"_").concat(_.name,"_onBlur")]){t.next=3;break}return t.next=3,x("".concat(D,"_").concat(_.name,"_onBlur"),{"value":e,"currentRow":c.getFieldValue([D,w]),"rowIndex":w},D,w);case 3:b("".concat(D,".").concat(_.name),e,w),Object.keys(f).find((function(e){return f[e].exec_formula&&-1!==f[e].exec_formula.reference_fields.indexOf("".concat(D,".").concat(_.name))}))&&m(D,w),Object.keys(f).find((function(e){return f[e].sum&&f[e].sum.options.field_key===_.key}))&&O(D),p(["".concat(D,".").concat(_.name)],w);case 7:case"end":return t.stop()}}),_callee)})));return function onBlur(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(C.a)(Object(y.a)().mark((function _callee2(e){return Object(y.a)().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("selected_data",e),!h["".concat(D,"_").concat(_.name,"_onSelect")]){t.next=4;break}return t.next=4,x("".concat(D,"_").concat(_.name,"_onSelect"),{"value":e,"currentRow":c.getFieldValue([D,w]),"rowIndex":w},D,w);case 4:f["".concat(D,".").concat(_.name)]&&f["".concat(D,".").concat(_.name)].set_default_relation_field&&j("".concat(D,".").concat(_.name),e,w),b("".concat(D,".").concat(_.name),e,w),"Fields::ResourceField"===_.type&&P(e),"Fields::SelectField"===_.type&&L(e),Object.keys(f).find((function(e){return f[e].exec_formula&&-1!==f[e].exec_formula.reference_fields.indexOf("".concat(D,".").concat(_.name))}))&&m(D,w),p(["".concat(D,".").concat(_.name)],w);case 10:case"end":return t.stop()}}),_callee2)})));return function onSelect(t){return e.apply(this,arguments)}}(),E=_.is_disable_edit;_.is_disable_edit&&_.disable_edit_condition&&""!==_.disable_edit_condition&&(E=D?c.getFieldValue([D,w,"".concat(_.name,"_disable_edit")]):_.disable_edit);var V=E||"read_only"===_.accessibility||!_.can_modify||_.is_formula;return Object(d.jsx)(o.e,{"className":"form-item","children":Object(d.jsx)(l.a.Item,Object(a.a)(Object(a.a)({},_),{},{"className":"form-item-label","name":[v.name,_.name],"tooltip":!(!_.is_show_tip||"icon"!==_.tip_type)&&_.hint,"label":null,"initialValue":function getDefaultValue(){var e=_.default_value||_.options.default_value||_.options.default_enable;return!e&&"Fields::DateField"===_.type&&_.options.default_current_date?g()():e&&"Fields::MultipleSelectField"===_.type?[e]:e}(),"rules":Object(k.h)(_),"fieldKey":[v.fieldKey,_.name],"children":Object(d.jsx)(N,{"subFormName":D,"isDisable":V,"index":w,"overloadData":r,"field":_,"onBlur":B,"onSelect":I,"onDropdown":function onDropdown(e){h["".concat(D,"_").concat(_.name,"_onDropdown")]&&x("".concat(D,"_").concat(_.name,"_onDropdown"),Object(a.a)(Object(a.a)({},e),{},{"currentRow":c.getFieldValue([D,w]),"rowIndex":w}),D,w)}})}))})},N=function FormItem(e){var t=e.isDisable,n=e.field,c=Object(k.h)(n).find((function(e){return e.required})),i="Fields::MultipleAttachmentField"===n.type||"Fields::MultipleImageField"===n.type?"  ":n.label;return Object(d.jsxs)(o.e,{"className":"formItem space-between","children":[Object(d.jsxs)("span",{"className":t?"label disable":"label","children":[Object(d.jsx)("span",{"className":"required","children":c?"*":""}),i]}),Object(d.jsx)(o.e,{"className":t?"element disable":"element","children":Object(d.jsx)(s.a,Object(a.a)({},e))})]})},ListFiled=function(e){var t=e.field,n=e.section,a=e.record,l=e.fieldData,r=e.setActiveKey,s=e.index,u=Object(i.useState)({}),f=Object(c.a)(u,2),j=f[0],O=f[1];return Object(i.useEffect)((function(){var e={};t.fields.map((function(t){e[t.name]=function getDefaultValue(e){var t=e.default_value||e.options.default_value||e.options.default_enable;return t||"Fields::DateField"!==e.type&&"Fields::DatetimeField"!==e.type||!e.options.default_current_date?t&&"Fields::MultipleSelectField"===e.type?[t]:t:g()()}(t)||null})),O(e)}),[]),Object(d.jsxs)(o.e,{"className":"swiperContent","children":[Object(d.jsx)(o.e,{"className":"swiperContent-content","children":t.fields.map((function(e){return Object(d.jsx)(components_FormItem,{"values":j,"record":a,"setValues":O,"fieldData":l,"section":n,"field":e,"index":s})}))}),Object(d.jsx)(o.e,{"className":"buttomBtn","onClick":function onClick(){return r("")},"children":Object(d.jsxs)(b.b,{"className":"buttomBtnText","children":["收起",n.title+(a.name+1),Object(d.jsx)(m.a,{})]})})]})},F=n(284),SumField=function(e){var t=e.field,n=e.data;return Object(d.jsx)(l.a.Item,{"className":"sumFieldContent","label":null,"name":t.name,"labelCol":{"span":16},"wrapperCol":{"span":8},"initialValue":n&&n[t.name]||0,"children":Object(d.jsx)(w,{"field":t})},t.id)},w=function FormItem(e){var t=e.field;return Object(d.jsxs)(o.e,{"className":"sumFiledItem","children":[Object(d.jsxs)("span",{"className":"sumFiledItemText","children":[t.label,":"]}),Object(d.jsx)(F.a,Object(a.a)(Object(a.a)({},e),{},{"disabled":!0,"className":"disableSumInput","bordered":!1}))]})},SubSection=function(e){var t=e.section,n=e.data,a=e.form,r=Object(i.useState)(!1),s=Object(c.a)(r,2),u=s[0],f=s[1],j=t.fields.filter((function(e){return-1!==e.mobile_view.indexOf(n.id?"edit":"new")&&"hidden"!==e.accessibility})),m=j?j.key:"",_=Object(i.useState)(n&&n[m]?n[m]:[]),g=Object(c.a)(_,2),y=g[0],C=g[1],k=Object(i.useState)(""),N=Object(c.a)(k,2),F=N[0],w=N[1],S=Object(i.useState)(!1),D=Object(c.a)(S,2),L=D[0],P=D[1];return Object(d.jsx)(o.e,{"className":"subSelectionContent","children":"step_form"===a.category?Object(d.jsxs)(d.Fragment,{"children":[Object(d.jsx)(l.a.List,{"name":t.fields[0].name,"children":function children(e,n,a){var c=n.add,r=n.remove,s=a.errors;return Object(d.jsxs)(d.Fragment,{"children":[Object(d.jsx)(b.g,{"className":"collapse-content","accordion":!0,"activeKey":F+"","children":e.map((function(e,n){var a;return Object(d.jsx)(b.g.Panel,{"className":"title-content","title":t.title+(e.name+1),"onClick":function onClick(){return w(L||F===e.name?"":e.name)},"arrow":function arrow(t){return Object(d.jsxs)(o.e,{"className":"arrow","children":[t?Object(d.jsx)(h.a,{}):Object(d.jsx)(p.a,{}),Object(d.jsx)(o.e,{"className":"delete","onClick":function onClick(){P(!0),b.i.show({"content":"确认删除","closeOnAction":!0,"actions":[[{"key":"cancel","text":"取消","onClick":function onClick(){P(!1)}},{"key":"delete","text":"删除","bold":!0,"danger":!0,"onClick":function onClick(){P(!1),r(e.name),C(y.filter((function(t){return y[e.name]!==t})))}}]]})},"children":Object(d.jsx)(x.a,{"color":"var(--adm-color-danger)"})})]})},"children":Object(i.createElement)(ListFiled,(a={"setActiveKey":w,"fieldData":y,"section":t,"record":e,"index":n,"remove":r,"setFieldData":C},Object(O.a)(a,"index",n),Object(O.a)(a,"key",n),Object(O.a)(a,"showVisible",u),Object(O.a)(a,"field",j[0]),a))},e.name+"")}))}),Object(d.jsx)(o.e,{"onClick":function onClick(){c(),f(!0)},"className":"addContent","children":Object(d.jsxs)(o.d,{"className":"title","children":[t.title,Object(d.jsx)(v.a,{})]})}),Object(d.jsx)(l.a.ErrorList,{"errors":s})]})}}),j.filter((function(e){return"Fields::SumField"===e.type})).map((function(e,a){return Object(i.createElement)(SumField,{"fieldData":y,"index":a,"data":n,"section":t,"key":e.id,"type":n.id?"edit":"new","field":e})}))]}):Object(d.jsx)(b.g,{"className":"section-content","children":Object(d.jsxs)(b.g.Panel,{"title":t.title,"children":[Object(d.jsx)(l.a.List,{"name":t.fields[0].name,"children":function children(e,n,a){var c=n.add,r=n.remove,s=a.errors;return Object(d.jsxs)(d.Fragment,{"children":[Object(d.jsx)(b.g,{"className":"collapse-content","accordion":!0,"activeKey":F+"","children":e.map((function(e,n){return Object(d.jsx)(b.g.Panel,{"className":"title-content","title":t.title+(e.name+1),"onClick":function onClick(){return w(L||F===e.name?"":e.name)},"arrow":function arrow(t){return Object(d.jsxs)(o.e,{"className":"arrow","children":[t?Object(d.jsx)(h.a,{}):Object(d.jsx)(p.a,{}),Object(d.jsx)(o.e,{"className":"delete","onClick":function onClick(){P(!0),b.i.show({"content":"确认删除","closeOnAction":!0,"actions":[[{"key":"cancel","text":"取消","onClick":function onClick(){P(!1)}},{"key":"delete","text":"删除","bold":!0,"danger":!0,"onClick":function onClick(){P(!1),r(e.name),C(y.filter((function(t){return y[e.name]!==t})))}}]]})},"children":Object(d.jsx)(x.a,{"color":"var(--adm-color-danger)"})})]})},"children":Object(i.createElement)(ListFiled,{"setActiveKey":w,"fieldData":y,"section":t,"record":e,"index":n,"remove":r,"setFieldData":C,"key":n,"showVisible":u,"field":j[0]})},e.name+"")}))}),Object(d.jsx)(o.e,{"onClick":function onClick(){c(),f(!0)},"className":"addContent","children":Object(d.jsxs)(o.d,{"className":"title","children":[t.title,Object(d.jsx)(v.a,{})]})}),Object(d.jsx)(l.a.ErrorList,{"errors":s})]})}}),j.filter((function(e){return"Fields::SumField"===e.type})).map((function(e,a){return Object(i.createElement)(SumField,{"fieldData":y,"index":a,"data":n,"section":t,"key":e.id,"type":n.id?"edit":"new","field":e})}))]},"")})})},S=n(268),D=n(468),L=n(478),P=n(221),B=function SelectAddress(e){var t=Object(i.useContext)(q).addresses,n=e.section,a=e.data,r=e.form,s=Object(i.useState)(!1),o=Object(c.a)(s,2),u=o[0],f=o[1];Object(i.useEffect)((function(){f(!a.id)}),[a]);var j=function contentRender(){return Object(d.jsxs)("div",{"className":"baseForm","children":[Object(d.jsx)(l.a.Item,{"name":n.fields[0].name,"style":{"marginBottom":10},"rules":Object(k.h)(n.fields[0]),"children":Object(d.jsx)(P.default,{"field":n.fields[0],"placeholder":u?"请输入或选择地址":"","isDisable":!u})}),a.id&&Object(d.jsx)("p",{"style":{"marginLeft":5,"marginBottom":10},"children":u?Object(d.jsx)("a",{"onClick":function onClick(){return f(!1)},"children":"确定"}):Object(d.jsx)("a",{"onClick":function onClick(){return f(!0)},"children":"修改"})}),u&&Object.keys(t).length>0&&Object(d.jsx)("div",{"style":{"backgroundColor":"#fafafa","padding":20,"maxHeight":210,"overflow":"scroll"},"children":Object(d.jsx)(l.a.Item,{"name":n.fields[0].name,"style":{"marginBottom":0},"children":Object(d.jsx)(S.a.Group,{"children":Object.keys(t).map((function(e){return(t[e]||[]).length>0&&Object(d.jsxs)("div",{"children":[Object(d.jsxs)(D.a,{"orientation":"left","style":{"margin":"10px 0","borderColor":"#fafafa","color":"gray","fontSize":13,"fontWeight":"normal"},"children":[e," ","地址"]}),Object(d.jsx)(L.b,{"direction":"vertical","children":t[e].map((function(e){return Object(d.jsx)(S.a,{"value":e.address,"children":e.address},e.id)}))})]},e)}))})})})]})};return Object(d.jsx)(d.Fragment,{"children":"step_form"===r.category?j():Object(d.jsx)(b.g,{"children":Object(d.jsx)(b.g.Panel,{"title":n.title,"children":j()},"0")})})},I=n(251),E=function normFile(e){return Array.isArray(e)?e:e&&e.fileList},FilesUpload=function(e){var t=e.section,n=e.data,a=e.form,r=Object(i.useState)([]),s=Object(c.a)(r,2),u=(s[0],s[1]),f=t.fields[0];return Object(i.useEffect)((function(){u((f&&n[f.name]||[]).map((function(e){return{"uid":e.id,"name":Object(d.jsxs)("span",{"children":[e.name,Object(d.jsxs)("span",{"style":{"marginLeft":20,"color":"#ccc"},"children":[e.size,"KB"]})]}),"status":"done","url":e.url}})))}),[n]),Object(d.jsx)(o.e,{"className":"form-item-label","children":"step_form"===a.category?Object(d.jsx)(l.a.Item,{"className":"element-field","name":t.fields[0].name,"style":{"marginBottom":0},"valuePropName":"fileList","getValueFromEvent":E,"children":Object(d.jsx)(I.default,{"isDisable":!1})}):Object(d.jsx)(b.g,{"children":Object(d.jsx)(b.g.Panel,{"title":t.title,"children":Object(d.jsx)(l.a.Item,{"className":"element-field","name":t.fields[0].name,"style":{"marginBottom":0},"valuePropName":"fileList","getValueFromEvent":E,"children":Object(d.jsx)(I.default,{"isDisable":!1})})},"")})})},V=n(252),R=function normFile(e){return Array.isArray(e)?e:e&&e.fileList},ImagesUpload=function(e){var t=e.section;e.form;return Object(d.jsx)(o.e,{"className":"form-item-label","children":Object(d.jsx)(b.g,{"children":Object(d.jsx)(b.g.Panel,{"title":t.display_label,"children":Object(d.jsx)(l.a.Item,{"className":"element-field","name":t.fields[0].api_name,"style":{"marginBottom":0},"valuePropName":"fileList","getValueFromEvent":R,"children":Object(d.jsx)(V.default,{"isDisable":!1})})},"")})})},Section=function(e){var t=e.form,n=e.section,a=e.data;return function renderSection(){return"sub_form"===n.data_type?Object(d.jsx)(SubSection,{"section":n,"data":a,"form":t}):"address"===n.data_type?Object(d.jsx)(B,{"section":n,"data":a,"form":t}):"attachment"===n.data_type?Object(d.jsx)(FilesUpload,{"section":n,"data":a,"form":t}):"profileimage"===n.data_type?Object(d.jsx)(ImagesUpload,{"section":n,"data":a,"form":t}):Object(d.jsx)(BaseSection,{"section":n,"data":a,"form":t})}()},A=(n(49),n(265),n(699)),H=n(19),z=n(24),U=n(257),q=Object(i.createContext)({});t.b=function(e){var t=e.form,n=e.sections,s=e.data,f=e.customRefForm,j=e.module,m=e.title,O=e.id,p=f||l.a.useForm(),h=Object(c.a)(p,1)[0],x=Object(i.useState)(!1),v=Object(c.a)(x,2),_=v[0],g=v[1],y=Object(i.useState)(),C=Object(c.a)(y,2),k=C[0],N=C[1];Object(i.useEffect)((function(){!function getZOHOuser(){var e=Object(A.a)("currentUser");e&&N(e)}()}),[]);var F=function onFinish(e){g(!0);var t={"name":"","description":"","phone":"","amount":0};switch(j){case"Leads":t.name=e.Company,t.description=e.Full_Name,t.phone=e.Phone;break;case"Potentials":t.name=e.Deal_Name,t.description=e.Stage,t.amount=e.Amount;break;case"Accounts":t.name=e.Account_Name,t.description=e.Department,t.phone=e.Phone;break;case"Public_Leads":t.name=e.Name,t.description=e.Last_Name,t.phone=e.Phone}O?(console.log("编辑"),u.a.put("/crm/v2/".concat(j,"/").concat(O),{"data":[Object(a.a)({},e)]}).then((function(e){e.data&&("SUCCESS"===e.data[0].code?(r.b.success("修改成功"),Object(H.d)()):r.b.error("修改失败，请重试"))})).catch((function(e){g(!1),console.log(e),r.b.error("修改失败，请重试")}))):u.a.post("/crm/v2/".concat(j),{"data":[Object(a.a)({},e)]}).then((function(n){console.log("res",n),n.data&&("SUCCESS"===n.data[0].code?(r.b.success("创建成功"),Object(H.g)({"url":"pages/main/workbench/zoho/show/index?module_name=".concat(j,"&zoho_id=").concat(n.data[0].details.id,"&title=").concat(m,"&name=").concat(t.name,"&description=").concat(t.description,"&phone=").concat(t.phone,"&amount=").concat(t.amount)}),z.a.eventCenter.trigger("addItem",Object(a.a)(Object(a.a)({},e),n.data[0].details))):r.b.error("创建失败，请重试"))})).catch((function(e){console.log(e),g(!1),r.b.error("创建失败，请重试")}))},w=Object(a.a)(Object(a.a)({},e),{},{"refForm":h,"zohoUser":k});return Object(d.jsxs)(q.Provider,{"value":w,"children":[Object(d.jsx)(b.w,{"onBack":function onBack(){"show"===e.open_type?e.onBack&&e.onBack():Object(H.d)()},"right":Object(d.jsx)(o.d,{"className":"form-save","onClick":function onClick(){_||function submitForm(){h.validateFields().then((function(e){if("Leads"===j){var t={};e.Phone?t.phone=e.Phone:delete t.phone,e.Company?t.name=e.Company:delete t.name,O&&(e.Company===s.Company&&delete t.name,e.Phone===s.Phone&&delete t.phone),t.phone||t.name?(g(!0),U.a.post("/api/v1/functions/account_duplicate_check/execute",{"params":{"form_data":t}},{"headers":{"Content-Type":"application/json","Authorization":"Bearer NYbImmWjVdyN8Dh8PPq4XqVuKNCNWcp5dCDa8o2Xtyg"}}).then((function(t){200===t.code&&("无重复"===t.data.result?F(e):(g(!1),b.L.show({"content":Object(d.jsx)(o.e,{"style":{"display":"flex","flexDirection":"column"},"children":t.data.result.map((function(e,t){return Object(d.jsx)(o.d,{"children":e},t)}))}),"duration":5e3})))})).catch((function(){g(!1)}))):F(e)}else F(e)})).catch((function(e){var t=document.getElementById(e.errorFields[0].name[0]);t&&t.scrollIntoView(),e.errorFields.forEach((function(e){r.b.error(e.errors)}))}))}()},"children":"保存"}),"children":O?"编辑":"创建"}),Object(d.jsxs)(o.c,{"className":"form-container","children":[Object(d.jsx)(l.a,{"form":h,"layout":"horizontal","labelWrap":!0,"onFinish":F,"children":n.filter((function(e){return!e.hidden})).map((function(e,n){return Object(d.jsx)(Section,{"form":t,"data":s,"section":e},n)}))}),Object(d.jsx)(o.e,{"className":"submit-btn"})]}),Object(d.jsx)(b.u,{"visible":_})]})}},"243":function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(6),c=n(5),i=n(13),l=n(10),r=n(11),s=n(43),o=n(14),u=n(170);window;Error;var d=function(){function HttpClient(){Object(c.a)(this,HttpClient)}return Object(a.a)(HttpClient,null,[{"key":"parseResponse","value":function parseResponse(e){console.log("parseResponse",e);var t=e.data;return 201===e.status?t:Promise.reject(t)}},{"key":"get","value":function get(e,t){return u.a.get(e,t).then((function(e){return HttpClient.parseResponse(e)}))}},{"key":"put","value":function put(e,t){return u.a.put(e,t).then((function(e){return HttpClient.parseResponse(e)}))}},{"key":"delete","value":function _delete(e,t){return u.a.delete(e,t).then((function(e){return HttpClient.parseResponse(e)}))}},{"key":"post","value":function post(e,t,n){return u.a.post(e,t,n).then((function(e){return HttpClient.parseResponse(e)}))}}]),HttpClient}()},"251":function(e,t,n){"use strict";n.r(t);var a=n(134),c=n(18),i=n(20),l=n(440),r=n(176),s=n(486),o=n(222),u=n(140),d=n(136);t.default=function(e){var t=e.isDisable,n=e.onChange,f=Object(i.useState)([]),j=Object(c.a)(f,2),m=j[0],b=j[1],O=Object(i.useContext)(o.a).type;Object(i.useEffect)((function(){var t=(e.value||[]).map((function(e){return{"uid":e.id,"name":Object(d.jsxs)("span",{"children":[e.name,Object(d.jsxs)("span",{"style":{"marginLeft":20,"color":"#ccc"},"children":[e.size,"KB"]})]}),"status":"done","url":e.url}}));b("new"!==O?t:[])}),[]);var p={"name":"file","multiple":!0,"fileList":m,"beforeUpload":function beforeUpload(){return!1},"onChange":function onChange(e){b(e.fileList),n&&n(e.fileList)}};return Object(d.jsx)(u.e,{"className":"attachment-field","children":Object(d.jsx)(l.a,Object(a.a)(Object(a.a)({},p),{},{"children":!t&&Object(d.jsx)(r.a,{"icon":Object(d.jsx)(s.a,{}),"children":"选择文件"})}))})}},"252":function(e,t,n){"use strict";n.r(t);var a=n(134),c=n(16),i=n(22),l=n(18),r=n(20),s=n(440),o=n(442),u=n(483),d=n(222),f=n(140),j=n(136),m=function getBase64(e){return new Promise((function(t,n){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){return t(a.result)},a.onerror=function(e){return n(e)}}))};t.default=function(e){var t=e.isDisable,n=e.onChange,b=Object(r.useContext)(d.a).type;Object(r.useEffect)((function(){var t=(e.value||[]).map((function(e){return{"uid":e.id,"name":e.name,"status":"done","url":e.url,"thumbUrl":e.thumb_url}}));v("new"!==b?t:[]),t.length&&n&&n(t)}),[]);var O,p=Object(r.useState)([]),h=Object(l.a)(p,2),x=h[0],v=h[1],_=Object(r.useState)(!1),g=Object(l.a)(_,2),y=g[0],C=g[1],k=Object(r.useState)(""),N=Object(l.a)(k,2),F=N[0],w=N[1],S={"name":"file","multiple":!0,"fileList":x,"accept":"image/*","defaultFileList":x,"beforeUpload":function beforeUpload(){return!1},"onChange":function onChange(e){v(e.fileList),n&&n(e.fileList)},"onPreview":(O=Object(i.a)(Object(c.a)().mark((function _callee(e){return Object(c.a)().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(e.url||e.preview){t.next=4;break}return t.next=3,m(e.originFileObj);case 3:e.preview=t.sent;case 4:C(!0),w(e.url||e.preview);case 6:case"end":return t.stop()}}),_callee)}))),function onPreview(e){return O.apply(this,arguments)})};return Object(j.jsxs)(f.e,{"className":"image-field","children":[Object(j.jsx)(s.a,Object(a.a)(Object(a.a)({"listType":"picture-card"},S),{},{"children":!t&&Object(j.jsx)(u.a,{})})),Object(j.jsx)("div",{"style":{"display":"none"},"children":Object(j.jsx)(o.a.PreviewGroup,{"preview":{"visible":y,"onVisibleChange":function onVisibleChange(e){return C(e)}},"children":Object(j.jsx)(o.a,{"src":F})})})]})}},"257":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(5),c=n(6),i=n(243),l=n(917),r=function(){function HttpLoading(){Object(a.a)(this,HttpLoading)}return Object(c.a)(HttpLoading,null,[{"key":"get","value":function get(e,t){return Object(l.b)(),i.a.get(e,t).then((function(e){return Object(l.a)(),e})).catch((function(e){return Object(l.a)(),Promise.reject(e)}))}},{"key":"put","value":function put(e,t){return Object(l.b)(),i.a.put(e,t).then((function(e){return Object(l.a)(),e})).catch((function(e){return Object(l.a)(),Object(l.c)({"icon":"error","title":e.message,"duration":2e3}),Promise.reject(e)}))}},{"key":"post","value":function post(e,t,n){return Object(l.b)(),i.a.post(e,t,n).then((function(e){return Object(l.a)(),console.log("HttpLoading.posr-then",e),Promise.resolve(e)})).catch((function(e){return console.log("post",e),Object(l.a)(),Object(l.c)({"icon":"error","title":e.message,"duration":2e3}),Promise.reject(e)}))}}]),HttpLoading}()},"265":function(e,t,n){},"281":function(e,t,n){"use strict";n.r(t);var a=n(134),c=n(18),i=n(140),l=n(143),r=n(20),s=(n(191),n(900)),o=n(172),u=n(222),d=n(891),f=n(600),j=n(136);t.default=function(e){var t=e.onChange,n=e.isDisable,m=e.onSelect,b=(e.field,Object(r.useContext)(u.a)),O=b.zohoUser,p=b.data,h=function getUsers(e,t){t?o.a.post("/crm/v2/coql",{"select_query":'select first_name, phone, email, role from users where first_name like "%'.concat(t,'%" or email like "%').concat(t,'%"')}).then((function(t){console.log("getUsers",t),t.data&&(N(e),g(1===e?t.data:_.concat(t.data)),D(t.info))})).catch((function(){g([])})):o.a.get("/crm/v2/users",{"type":"AllUsers"}).then((function(t){t.users&&(N(e),g(1===e?t.users:_.concat(t.users)),D(t.info))})).catch((function(){g([])}))},x=Object(r.useState)([]),v=Object(c.a)(x,2),_=v[0],g=v[1],y=Object(r.useState)(1),C=Object(c.a)(y,2),k=C[0],N=C[1],F=Object(r.useState)({"more_records":!0}),w=Object(c.a)(F,2),S=w[0],D=w[1],L=Object(r.useState)(!1),P=Object(c.a)(L,2),B=P[0],I=P[1],E=Object(r.useState)(),V=Object(c.a)(E,2),R=V[0],A=V[1],H=Object(r.useState)(""),z=Object(c.a)(H,2),U=z[0],q=z[1],K=function onSearch(e){h(1,e||""),q(e)},M=["销售工程师","战区经理","销售经理","DCC","大区总经理","Administrator"];return Object(j.jsxs)(i.e,{"className":"field","onClick":function onClick(){if(p){if(p.id&&O&&!M.find((function(e){return e===O.profile.name})))return void d.b.warn("权限不足");I(!n),_.length||h(1)}else I(!n),_.length||h(1)},"children":[Object(j.jsxs)(i.e,{"className":"field-content","children":[Object(j.jsx)(i.d,{"className":"field-text","children":R?R.first_name||R.name:e.value?e.value.name:""}),Object(j.jsx)(s.a,{})]}),Object(j.jsx)(l.z,{"className":"picklist-popup","visible":B,"onMaskClick":function onMaskClick(){I(!1)},"bodyStyle":{"minHeight":"90vh"},"children":Object(j.jsxs)(i.e,{"className":"picklist-popup-content","children":[Object(j.jsxs)(f.a,{"align":"middle","className":"picklist-view-input","children":[Object(j.jsx)(l.C,{"style":{"flex":1},"value":U,"onChange":q,"onClear":function onClear(){K("")},"onSearch":function onSearch(){return K(U)}}),U&&Object(j.jsx)(l.c,{"color":"primary","size":"small","style":{"marginLeft":"10px"},"onClick":function onClick(){return K(U)},"children":"搜索"})]}),Object(j.jsxs)(i.c,{"scrollY":!0,"enhanced":!0,"lowerThreshold":200,"className":"picklist","onScrollToLower":function onScrollToLower(){S.more_records&&h(k+1)},"children":[Object(j.jsx)(l.e,{"defaultValue":e.value?[e.value]:[],"onChange":function onChange(e){A(_.find((function(t){return t.id===e[0].id})));var n=Object(a.a)(Object(a.a)({},e[0]),{},{"name":e[0].first_name,"id":e[0].id});t&&t(n.id),m&&m(n),I(!1)},"children":_.map((function(e,t){return Object(j.jsx)(l.e.Item,{"value":e,"children":Object(j.jsxs)(i.e,{"className":"user-item","children":[Object(j.jsx)(i.e,{"className":"user-acatar","children":e.zuid?Object(j.jsx)(l.o,{"src":"https://contacts.zoho.com.cn/file?ID=".concat(e.zuid,"&fs=thumb")}):e.first_name[0]}),Object(j.jsxs)(i.e,{"children":[Object(j.jsx)(i.e,{"children":e.first_name}),Object(j.jsx)(i.e,{"className":"user-email","children":e.email})]})]})},t)}))}),!_.length&&U&&Object(j.jsxs)(l.j,{"style":{"marginTop":"20px"},"children":['未找到 "',U,'"']})]})]})})]})}},"600":function(e,t,n){"use strict";var a=n(250);t.a=a.a}}]);