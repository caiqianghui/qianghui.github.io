(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"195":function(e,t,n){"use strict";n.d(t,"b",(function(){return getUserSelections})),n.d(t,"d",(function(){return getWarehouseStock})),n.d(t,"c",(function(){return getWarehouseBatchStock})),n.d(t,"a",(function(){return getSelections}));var a=n(16),r=n(22),c=n(162);function getUnits(e){return _getUnits.apply(this,arguments)}function _getUnits(){return(_getUnits=Object(r.a)(Object(a.a)().mark((function _callee(e){return Object(a.a)().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/product_manage/units/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee)})))).apply(this,arguments)}function getPricingSystems(e){return _getPricingSystems.apply(this,arguments)}function _getPricingSystems(){return(_getPricingSystems=Object(r.a)(Object(a.a)().mark((function _callee2(e){return Object(a.a)().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/price_manage/pricing_systems/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee2)})))).apply(this,arguments)}function getCategories(e){return _getCategories.apply(this,arguments)}function _getCategories(){return(_getCategories=Object(r.a)(Object(a.a)().mark((function _callee4(e){return Object(a.a)().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/product_manage/categories/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee4)})))).apply(this,arguments)}function getBrands(e){return _getBrands.apply(this,arguments)}function _getBrands(){return(_getBrands=Object(r.a)(Object(a.a)().mark((function _callee5(e){return Object(a.a)().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/product_manage/brands/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee5)})))).apply(this,arguments)}function getUserSelections(e){return _getUserSelections.apply(this,arguments)}function _getUserSelections(){return(_getUserSelections=Object(r.a)(Object(a.a)().mark((function _callee7(e){return Object(a.a)().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/account/users/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee7)})))).apply(this,arguments)}function getWarehouses(e){return _getWarehouses.apply(this,arguments)}function _getWarehouses(){return(_getWarehouses=Object(r.a)(Object(a.a)().mark((function _callee8(e){return Object(a.a)().wrap((function _callee8$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/warehouse_manage/warehouses/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee8)})))).apply(this,arguments)}function getWarehouseStock(e){return _getWarehouseStock.apply(this,arguments)}function _getWarehouseStock(){return(_getWarehouseStock=Object(r.a)(Object(a.a)().mark((function _callee9(e){return Object(a.a)().wrap((function _callee9$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/warehouse_manage/warehouses/warehouse_stock",{"params":e}));case 1:case"end":return t.stop()}}),_callee9)})))).apply(this,arguments)}function getWarehouseBatchStock(e){return _getWarehouseBatchStock.apply(this,arguments)}function _getWarehouseBatchStock(){return(_getWarehouseBatchStock=Object(r.a)(Object(a.a)().mark((function _callee10(e){return Object(a.a)().wrap((function _callee10$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/warehouse_manage/warehouses/batch_stock",{"params":e}));case 1:case"end":return t.stop()}}),_callee10)})))).apply(this,arguments)}function getTabSelections(e,t){return _getTabSelections.apply(this,arguments)}function _getTabSelections(){return(_getTabSelections=Object(r.a)(Object(a.a)().mark((function _callee17(e,t){return Object(a.a)().wrap((function _callee17$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",c.a.get("/api/v1/".concat(e,"/selection"),{"params":t}));case 1:case"end":return n.stop()}}),_callee17)})))).apply(this,arguments)}function getSelections(e,t){return _getSelections.apply(this,arguments)}function _getSelections(){return(_getSelections=Object(r.a)(Object(a.a)().mark((function _callee18(e,t){return Object(a.a)().wrap((function _callee18$(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next="units"===n.t0?3:"warehouses"===n.t0?4:"categories"===n.t0?5:"brands"===n.t0?6:"pricing_systems"===n.t0?7:8;break;case 3:return n.abrupt("return",getUnits(t));case 4:return n.abrupt("return",getWarehouses(t));case 5:return n.abrupt("return",getCategories(t));case 6:return n.abrupt("return",getBrands(t));case 7:return n.abrupt("return",getPricingSystems(t));case 8:return n.abrupt("return",getTabSelections(e,t));case 9:case"end":return n.stop()}}),_callee18)})))).apply(this,arguments)}},"473":function(e,t,n){"use strict";n.r(t);var a=n(16),r=n(134),c=n(22),i=n(18),s=n(143),o=n(20),l=(n(205),n(140)),u=n(900),d=n(903),f=n(190),p=n.n(f),_=n(244),b=n(283),h=n(195),j=n(136);t.default=function(e){var t=e.onSelect,n=e.field,f=e.isDisable,m=e.onBlur,g=e.subFormName,O=e.index,v=e.initSelectionDatas,y=e.placeholder,k=e.subFormSelectSetting,x=e.overloadData,w=e.onChange,S=Object(o.useContext)(b.a),C=S.form,F=S.refForm,N=S.fields,W=S.sections,B=S.setSections,$=S.orderPromotionRef,q=Object(o.useState)([]),U=Object(i.a)(q,2),V=U[0],M=U[1],P=Object(o.useState)([]),D=Object(i.a)(P,2),T=D[0],I=D[1],E=Object(o.useState)(!1),J=Object(i.a)(E,2),R=J[0],z=J[1],H=Object(o.useState)(""),A=Object(i.a)(H,2),G=A[0],K=A[1],L=Object(o.useState)(""),Q=Object(i.a)(L,2),X=Q[0],Y=Q[1],Z=Object(o.useState)(1),ee=Object(i.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(o.useState)(!0),re=Object(i.a)(ae,2),ce=re[0],ie=re[1],se=g?(x[g]||[])[O]&&x[g][O][n.name]&&x[g][O][n.name].related_field_search_condition:x[n.name]&&x[n.name].related_field_search_condition;Object(o.useEffect)((function(){k&&Object(_.a)({"form_name":n.options.data_source_type}).then((function(e){if(e.data){var t={};k.show_columns.forEach((function(n){var a=e.data.fields.filter((function(e){return e.id===n}))[0];a&&(t[a.id]={"name":a.name,"label":a.label})})),console.log(t,"sssssss")}}))}),[]);var oe=function(){var t=Object(c.a)(Object(a.a)().mark((function _callee(){var t,c,i,s,o,l,u,d,f=arguments;return Object(a.a)().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:t=f.length>0&&void 0!==f[0]?f[0]:{},c=f.length>1?f[1]:void 0,n.options.data_source_type&&(i=null,g?(s=N.filter((function(e){return"Fields::NestedFormField"===e.type&&e.name===g}))[0],i=s&&s.fields.filter((function(e){return e.is_default_relation_field&&2===e.default_relation_field.length&&e.default_relation_field[0]===n.key}))):i=(N||[]).filter((function(e){return e.is_default_relation_field&&2===e.default_relation_field.length&&e.default_relation_field[0]===n.key})),n.options.show_warehouse_stock&&g?(o=N.filter((function(e){return"Fields::NestedFormField"===e.type&&e.name===g}))[0],(l=o&&o.fields.filter((function(e){return"Fields::ResourceField"===e.type&&"products"===e.options.data_source_type}))[0])&&Object(h.d)({"product_id":F.getFieldValue([g,O,l.name])}).then((function(e){var t=(e.data||[]).map((function(e){return{"id":e.id,"name":"".concat(e.name,"（").concat(e.stock,"）")}}));M(t)}))):(u={"q":Object(r.a)(Object(r.a)({},t||{}),se||n.related_field_search_condition||{}),"page":c,"sub_form_select_setting_id":k&&k.id,"search_field_id":n.id,"form_name":C&&C.name,"is_auth":n.options.data_range_by_auth,"show_column_options":JSON.stringify(n.options.show_column_options||[]),"related_fields":i&&i.map((function(e){return e.default_relation_field[1]})).join(",")},d=c,Object(h.a)(n.options.data_source_type,u).then((function(t){if(t.data){var n=[];n=t.data.datas.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{"label":e.show_name||e.name||e.number||e.title,"value":e.id})})),console.log("data",n),c>1?(I(V.concat(n)),M(V.concat(n))):(I((function(){if(!G&&e.value){var t,a=null===(t=n.find((function(t){return t.value===e.value})))||void 0===t?void 0:t.label;K(a||e.value),Y(a)}return n})),M(n)),d++,ne(d),ie(n.length>0)}else z(!1)}))));case 3:case"end":return a.stop()}}),_callee)})));return function searchSelectionDatas(){return t.apply(this,arguments)}}();Object(o.useEffect)((function(){console.log("props.value",e.value),e.value&&0===V.filter((function(t){return t.id===e.value})).length&&(v&&v[n.id]?(console.log("initSelectionDatas",v),M(v[n.id])):oe({"id_eq":e.value},te))}),[e.value]);var le=p.a.debounce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={};e&&(n.search_columns?a["".concat(n.search_columns.join("_or_"),"_cont")]=e:a.name_cont=e),Y(e),oe(a,t)}),500),ue=function(){var e=Object(c.a)(Object(a.a)().mark((function _callee2(){return Object(a.a)().wrap((function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:ce&&R&&le(X,te);case 1:case"end":return e.stop()}}),_callee2)})));return function loadMore(){return e.apply(this,arguments)}}();return-1!==["categories","brands"].indexOf(n.options.data_source_type)?Object(j.jsxs)(l.e,{"className":"field","onClick":function onClick(){f||z(!0)},"children":[Object(j.jsxs)(l.e,{"className":"field-content","children":[G?Object(j.jsx)(l.d,{"className":"field-text","children":G}):Object(j.jsx)(l.d,{"className":"field-placeholder","children":y||""}),Object(j.jsx)(u.a,{})]}),Object(j.jsx)(s.z,{"visible":R,"onMaskClick":function onMaskClick(){z(!1)},"bodyStyle":{"minHeight":"90vh"},"children":Object(j.jsxs)(l.e,{"className":"resource-popup","children":[Object(j.jsx)(s.s.Item,{"prefix":Object(j.jsx)(d.a,{}),"extra":Object(j.jsx)("a",{"onClick":function onClick(){return le(X)},"children":"搜索"}),"className":"search-content","children":Object(j.jsx)(s.r,{"placeholder":"请输入内容","value":X,"clearable":!0,"onChange":function onChange(e){return Y(e)}})}),Object(j.jsx)(l.e,{"className":"main","children":Object(j.jsxs)(s.e,{"defaultValue":e.value?[e.value]:[],"onChange":function onChange(e){if(0===e.length)K(""),t&&t(null),m&&m(null),w&&w("");else{var n=T.find((function(t){return t.value===e[0]}));K(n?n.label:""),t&&t(n||{}),m&&m(n||{}),w&&w(e[0])}z(!1)},"children":[T.map((function(e,t){return Object(j.jsx)(s.e.Item,{"value":e.value,"children":e.label},t)})),Object(j.jsx)(s.q,{"loadMore":ue,"hasMore":ce,"threshold":100})]})}),Object(j.jsx)(s.c,{"onClick":function onClick(){return z(!1)},"block":!0,"children":"关闭"})]})})]}):Object(j.jsxs)(l.e,{"className":"field","onClick":function onClick(){f||z(!0)},"children":[Object(j.jsxs)(l.e,{"className":"field-content","children":[G?Object(j.jsx)(l.d,{"className":"field-text","children":G}):Object(j.jsx)(l.d,{"className":"field-placeholder","children":y||""}),Object(j.jsx)(u.a,{})]}),Object(j.jsx)(s.z,{"visible":R,"onMaskClick":function onMaskClick(){z(!1)},"bodyStyle":{"minHeight":"90vh"},"children":Object(j.jsxs)(l.e,{"className":"resource-popup","children":[Object(j.jsx)(s.s.Item,{"prefix":Object(j.jsx)(d.a,{}),"extra":Object(j.jsx)("a",{"onClick":function onClick(){return le(X)},"children":"搜索"}),"className":"search-content","children":Object(j.jsx)(s.r,{"placeholder":"请输入内容","value":X,"clearable":!0,"onChange":function onChange(e){return Y(e)}})}),Object(j.jsx)(l.e,{"className":"main","children":Object(j.jsxs)(s.e,{"defaultValue":e.value?[e.value]:[],"onChange":function onChange(e){var a=T.find((function(t){return t.value===e[0]}));if(K(a?a.label:""),"sales_orders"===C.name&&"client_id"===n.name&&F.getFieldValue("client_id")&&(F.getFieldValue("sales_order_items")||[]).length>0)s.i.confirm({"title":"切换客户将清空已选择产品，确定要切换吗？","content":"因为产品价格和客户有关，所以会清空已选择产品","onConfirm":function onConfirm(){var n=V.filter((function(t){return t.id===e[0]}))[0];n&&($.current=n.current_promotion),w(void 0===e[0]?"":e[0]),t&&void 0===e[0]&&t(null),F.setFieldsValue({"sales_order_items":[],"sales_order_giveaways":[]})},"onCancel":function onCancel(){}});else if("sales_orders"===C.name&&"client_id"===n.name&&void 0===e[0]&&F.getFieldValue("client_id")&&(F.getFieldValue("sales_order_items")||[]).length>0)s.i.confirm({"title":"切换客户将清空已选择产品，确定要切换吗？","content":"因为产品价格和客户有关，所以会清空已选择产品","onConfirm":function onConfirm(){var n=V.filter((function(t){return t.id===e[0]}))[0];n&&($.current=n.current_promotion),w(void 0===e[0]?"":e[0]),t&&void 0===e[0]&&t(null),F.setFieldsValue({"sales_order_items":[],"sales_order_giveaways":[]})},"onCancel":function onCancel(){}});else{if("sales_orders"===C.name&&"client_id"===n.name){var c=V.filter((function(t){return t.id===e[0]}))[0];c&&($.current=c.current_promotion)}w(void 0===e[0]?"":e[0]),t&&!e[0]?t(null):t&&t(a||{}),"warehouses"===n.options.data_source_type&&function setBatchNumberChoices(e){if(g){var t=N.filter((function(e){return"Fields::NestedFormField"===e.type&&e.name===g}))[0],n=t&&t.fields.filter((function(e){return"Fields::ResourceField"===e.type&&"products"===e.options.data_source_type}))[0],a=t&&t.fields.filter((function(e){return"Fields::SelectField"===e.type&&"product_warehouse_batch"===e.options.source_type}))[0];n&&a&&Object(h.c)({"product_id":F.getFieldValue([g,O,n.name]),"warehouse_id":e}).then((function(e){console.log("getWarehouseBatchStock",e);var t=(e.data||[]).map((function(e){return{"id":e.id,"label":"".concat(e.name,"（").concat(e.stock,"）"),"batch_id":e.id}}));console.log(t,"newChoices",W),F.setFields([{"name":[g,O,a.name],"value":null}]),B(W.map((function(e){return"sub_form"!==e.category?e:Object(r.a)(Object(r.a)({},e),{},{"fields":e.fields.map((function(e,n){return n>0?e:Object(r.a)(Object(r.a)({},e),{},{"fields":e.fields.map((function(e){return e.id===a.id?Object(r.a)(Object(r.a)({},e),{},{"choices":t}):e}))})}))})})))}))}}(e[0])}z(!1)},"children":[T.map((function(e,t){return Object(j.jsx)(s.e.Item,{"value":e.value,"children":e.label},t)})),Object(j.jsx)(s.q,{"loadMore":ue,"hasMore":ce,"threshold":100})]})}),Object(j.jsx)(s.c,{"onClick":function onClick(){return z(!1)},"block":!0,"children":"关闭"})]})})]})}}}]);