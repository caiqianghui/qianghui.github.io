(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"195":function(e,t,n){"use strict";n.d(t,"b",(function(){return getUserSelections})),n.d(t,"d",(function(){return getWarehouseStock})),n.d(t,"c",(function(){return getWarehouseBatchStock})),n.d(t,"a",(function(){return getSelections}));var a=n(16),r=n(22),c=n(162);function getUnits(e){return _getUnits.apply(this,arguments)}function _getUnits(){return(_getUnits=Object(r.a)(Object(a.a)().mark((function _callee(e){return Object(a.a)().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/product_manage/units/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee)})))).apply(this,arguments)}function getPricingSystems(e){return _getPricingSystems.apply(this,arguments)}function _getPricingSystems(){return(_getPricingSystems=Object(r.a)(Object(a.a)().mark((function _callee2(e){return Object(a.a)().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/price_manage/pricing_systems/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee2)})))).apply(this,arguments)}function getCategories(e){return _getCategories.apply(this,arguments)}function _getCategories(){return(_getCategories=Object(r.a)(Object(a.a)().mark((function _callee4(e){return Object(a.a)().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/product_manage/categories/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee4)})))).apply(this,arguments)}function getBrands(e){return _getBrands.apply(this,arguments)}function _getBrands(){return(_getBrands=Object(r.a)(Object(a.a)().mark((function _callee5(e){return Object(a.a)().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/product_manage/brands/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee5)})))).apply(this,arguments)}function getUserSelections(e){return _getUserSelections.apply(this,arguments)}function _getUserSelections(){return(_getUserSelections=Object(r.a)(Object(a.a)().mark((function _callee7(e){return Object(a.a)().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/account/users/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee7)})))).apply(this,arguments)}function getWarehouses(e){return _getWarehouses.apply(this,arguments)}function _getWarehouses(){return(_getWarehouses=Object(r.a)(Object(a.a)().mark((function _callee8(e){return Object(a.a)().wrap((function _callee8$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/warehouse_manage/warehouses/selection",{"params":e}));case 1:case"end":return t.stop()}}),_callee8)})))).apply(this,arguments)}function getWarehouseStock(e){return _getWarehouseStock.apply(this,arguments)}function _getWarehouseStock(){return(_getWarehouseStock=Object(r.a)(Object(a.a)().mark((function _callee9(e){return Object(a.a)().wrap((function _callee9$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/warehouse_manage/warehouses/warehouse_stock",{"params":e}));case 1:case"end":return t.stop()}}),_callee9)})))).apply(this,arguments)}function getWarehouseBatchStock(e){return _getWarehouseBatchStock.apply(this,arguments)}function _getWarehouseBatchStock(){return(_getWarehouseBatchStock=Object(r.a)(Object(a.a)().mark((function _callee10(e){return Object(a.a)().wrap((function _callee10$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.a.get("/api/v1/qudaoyi/warehouse_manage/warehouses/batch_stock",{"params":e}));case 1:case"end":return t.stop()}}),_callee10)})))).apply(this,arguments)}function getTabSelections(e,t){return _getTabSelections.apply(this,arguments)}function _getTabSelections(){return(_getTabSelections=Object(r.a)(Object(a.a)().mark((function _callee17(e,t){return Object(a.a)().wrap((function _callee17$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",c.a.get("/api/v1/".concat(e,"/selection"),{"params":t}));case 1:case"end":return n.stop()}}),_callee17)})))).apply(this,arguments)}function getSelections(e,t){return _getSelections.apply(this,arguments)}function _getSelections(){return(_getSelections=Object(r.a)(Object(a.a)().mark((function _callee18(e,t){return Object(a.a)().wrap((function _callee18$(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next="units"===n.t0?3:"warehouses"===n.t0?4:"categories"===n.t0?5:"brands"===n.t0?6:"pricing_systems"===n.t0?7:8;break;case 3:return n.abrupt("return",getUnits(t));case 4:return n.abrupt("return",getWarehouses(t));case 5:return n.abrupt("return",getCategories(t));case 6:return n.abrupt("return",getBrands(t));case 7:return n.abrupt("return",getPricingSystems(t));case 8:return n.abrupt("return",getTabSelections(e,t));case 9:case"end":return n.stop()}}),_callee18)})))).apply(this,arguments)}},"474":function(e,t,n){"use strict";n.r(t);var a=n(16),r=n(134),c=n(22),i=n(18),o=n(143),s=n(20),l=(n(210),n(140)),u=n(900),d=n(190),f=n.n(d),p=n(282),_=n(244),h=n(195),b=n(891),g=n(136);t.default=function(e){var t=e.onSelect,n=e.field,d=e.isDisable,m=e.onBlur,j=e.subFormName,O=e.index,v=e.initSelectionDatas,y=e.placeholder,w=e.subFormSelectSetting,S=e.overloadData,k=e.onChange,x=Object(s.useContext)(p.a),C=x.form,F=x.refForm,W=x.fields,B=x.sections,N=x.setSections,$=x.orderPromotionRef,q=Object(s.useState)([]),U=Object(i.a)(q,2),V=U[0],T=U[1],P=Object(s.useState)([]),D=Object(i.a)(P,2),E=D[0],J=D[1],R=Object(s.useState)(!1),A=Object(i.a)(R,2),I=A[0],M=A[1],z=Object(s.useState)(""),H=Object(i.a)(z,2),L=H[0],Y=H[1],G=Object(s.useState)(""),K=Object(i.a)(G,2),Q=K[0],X=K[1],Z=Object(s.useState)(1),ee=Object(i.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(s.useState)(!0),re=Object(i.a)(ae,2),ce=(re[0],re[1]),ie=j?(S[j]||[])[O]&&S[j][O][n.name]&&S[j][O][n.name].related_field_search_condition:S[n.name]&&S[n.name].related_field_search_condition,oe=Object(s.useState)(),se=Object(i.a)(oe,2),le=se[0],ue=se[1],de=Object(s.useState)(!1),fe=Object(i.a)(de,2),pe=fe[0],_e=fe[1];Object(s.useEffect)((function(){w&&Object(_.a)({"form_name":n.options.data_source_type}).then((function(e){if(e.data){var t={};w.show_columns.forEach((function(n){var a=e.data.fields.filter((function(e){return e.id===n}))[0];a&&(t[a.id]={"name":a.name,"label":a.label})})),console.log(t,"sssssss")}}))}),[]);var he=function(){var t=Object(c.a)(Object(a.a)().mark((function _callee(){var t,c,i,o,s,l,u,d,f=arguments;return Object(a.a)().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:t=f.length>0&&void 0!==f[0]?f[0]:{},c=f.length>1?f[1]:void 0,_e(!0),n.options.data_source_type&&(i=null,j?(o=W.filter((function(e){return"Fields::NestedFormField"===e.type&&e.name===j}))[0],i=o&&o.fields.filter((function(e){return e.is_default_relation_field&&2===e.default_relation_field.length&&e.default_relation_field[0]===n.key}))):i=(W||[]).filter((function(e){return e.is_default_relation_field&&2===e.default_relation_field.length&&e.default_relation_field[0]===n.key})),n.options.show_warehouse_stock&&j?(s=W.filter((function(e){return"Fields::NestedFormField"===e.type&&e.name===j}))[0],(l=s&&s.fields.filter((function(e){return"Fields::ResourceField"===e.type&&"products"===e.options.data_source_type}))[0])&&Object(h.d)({"product_id":F.getFieldValue([j,O,l.name])}).then((function(e){var t=(e.data||[]).map((function(e){return{"id":e.id,"name":"".concat(e.name,"（").concat(e.stock,"）")}}));T(t)}))):(u={"q":Object(r.a)(Object(r.a)({},t||{}),ie||n.related_field_search_condition||{}),"page":c,"sub_form_select_setting_id":w&&w.id,"search_field_id":n.id,"form_name":C&&C.name,"is_auth":n.options.data_range_by_auth,"show_column_options":JSON.stringify(n.options.show_column_options||[]),"related_fields":i&&i.map((function(e){return e.default_relation_field[1]})).join(",")},d=c,Object(h.a)(n.options.data_source_type,u).then((function(t){if(t.data){var n=[];n=t.data.datas.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{"label":e.show_name||e.name||e.number||e.title,"value":e.id})})),console.log("data",n),c>1?(J(V.concat(n)),T(V.concat(n))):(J((function(){if(!L&&e.value){var t,a=null===(t=n.find((function(t){return t.value===e.value})))||void 0===t?void 0:t.label;Y(a||e.value),X(a)}return n})),T(n)),d++,ne(d),ce(n.length>0),ue(t.data.info)}else M(!1);_e(!1)})).catch((function(e){_e(!1),b.b.error(e.tips)}))));case 4:case"end":return a.stop()}}),_callee)})));return function searchSelectionDatas(){return t.apply(this,arguments)}}();Object(s.useEffect)((function(){e.value&&0===V.filter((function(t){return t.id===e.value})).length&&(k&&k(e.value),v&&v[n.id]?T(v[n.id]):he({"id_eq":e.value},te))}),[e.value]);var be=f.a.debounce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={};e&&(n.search_columns?a["".concat(n.search_columns.join("_or_"),"_cont")]=e:a.name_cont=e),X(e),he(a,t)}),500);return Object(g.jsxs)(l.e,{"className":"form-field","onClick":function onClick(){d||(M(!0),E.length||he({},1))},"children":[Object(g.jsxs)(l.e,{"className":"form-field-content","children":[L?Object(g.jsx)(l.d,{"className":"form-field-content-text","children":L}):Object(g.jsx)(l.d,{"className":"form-field-content-placeholder","children":y||""}),Object(g.jsx)(u.a,{})]}),Object(g.jsx)(o.z,{"visible":I,"onMaskClick":function onMaskClick(){M(!1)},"bodyStyle":{"height":.9*window.innerHeight+"px"},"children":Object(g.jsxs)(l.e,{"className":"form-field-popup","children":[Object(g.jsx)(o.C,{"value":Q,"placeholder":"请输入关键字","onChange":X,"onSearch":function onSearch(){return be(Q)}}),Object(g.jsxs)(l.e,{"className":"form-field-popup-main","children":[Object(g.jsxs)(l.c,{"style":{"height":"100%"},"scrollY":!0,"lowerThreshold":200,"onScrollToLower":f.a.throttle((function(){le&&E.length!==le.total_count&&!pe&&he({"id_eq":e.value},te+1)}),1e3,{"leading":!0,"trailing":!1}),"children":[-1!==["categories","brands"].indexOf(n.options.data_source_type)?Object(g.jsx)(o.e,{"defaultValue":e.value?[e.value]:[],"onChange":function onChange(e){if(0===e.length)Y(""),t&&t(null),m&&m(null),k&&k("");else{var n=E.find((function(t){return t.value===e[0]}));Y(n?n.label:""),t&&t(n||{}),m&&m(n||{}),k&&k(e[0])}M(!1)},"children":E.map((function(e,t){return Object(g.jsx)(o.e.Item,{"value":e.value,"children":e.label},t)}))}):Object(g.jsx)(o.e,{"defaultValue":e.value?[e.value]:[],"onChange":function onChange(e){var a=E.find((function(t){return t.value===e[0]}));if(Y(a?a.label:""),"sales_orders"===C.name&&"client_id"===n.name&&F.getFieldValue("client_id")&&(F.getFieldValue("sales_order_items")||[]).length>0)o.i.confirm({"title":"切换客户将清空已选择产品，确定要切换吗？","content":"因为产品价格和客户有关，所以会清空已选择产品","onConfirm":function onConfirm(){var n=V.filter((function(t){return t.id===e[0]}))[0];n&&($.current=n.current_promotion),k(void 0===e[0]?"":e[0]),t&&void 0===e[0]&&t(null),F.setFieldsValue({"sales_order_items":[],"sales_order_giveaways":[]})},"onCancel":function onCancel(){}});else if("sales_orders"===C.name&&"client_id"===n.name&&void 0===e[0]&&F.getFieldValue("client_id")&&(F.getFieldValue("sales_order_items")||[]).length>0)o.i.confirm({"title":"切换客户将清空已选择产品，确定要切换吗？","content":"因为产品价格和客户有关，所以会清空已选择产品","onConfirm":function onConfirm(){var n=V.filter((function(t){return t.id===e[0]}))[0];n&&($.current=n.current_promotion),k(void 0===e[0]?"":e[0]),t&&void 0===e[0]&&t(null),F.setFieldsValue({"sales_order_items":[],"sales_order_giveaways":[]})},"onCancel":function onCancel(){}});else{if("sales_orders"===C.name&&"client_id"===n.name){var c=V.filter((function(t){return t.id===e[0]}))[0];c&&($.current=c.current_promotion)}k(void 0===e[0]?"":e[0]),t&&!e[0]?t(null):t&&t(a||{}),"warehouses"===n.options.data_source_type&&function setBatchNumberChoices(e){if(j){var t=W.filter((function(e){return"Fields::NestedFormField"===e.type&&e.name===j}))[0],n=t&&t.fields.filter((function(e){return"Fields::ResourceField"===e.type&&"products"===e.options.data_source_type}))[0],a=t&&t.fields.filter((function(e){return"Fields::SelectField"===e.type&&"product_warehouse_batch"===e.options.source_type}))[0];n&&a&&Object(h.c)({"product_id":F.getFieldValue([j,O,n.name]),"warehouse_id":e}).then((function(e){console.log("getWarehouseBatchStock",e);var t=(e.data||[]).map((function(e){return{"id":e.id,"label":"".concat(e.name,"（").concat(e.stock,"）"),"batch_id":e.id}}));console.log(t,"newChoices",B),F.setFields([{"name":[j,O,a.name],"value":null}]),N(B.map((function(e){return"sub_form"!==e.category?e:Object(r.a)(Object(r.a)({},e),{},{"fields":e.fields.map((function(e,n){return n>0?e:Object(r.a)(Object(r.a)({},e),{},{"fields":e.fields.map((function(e){return e.id===a.id?Object(r.a)(Object(r.a)({},e),{},{"choices":t}):e}))})}))})})))}))}}(e[0])}M(!1)},"children":E.map((function(e,t){return Object(g.jsx)(o.e.Item,{"value":e.value,"children":e.label},t)}))}),!E.length&&!pe&&Object(g.jsx)(l.d,{"style":{"display":"block","textAlign":"center","marginTop":"20px"},"children":"暂无数据"})]}),pe&&Object(g.jsxs)(l.d,{"style":{"display":"block","textAlign":"center","marginTop":"20px"},"children":["加载中",Object(g.jsx)(o.k,{})]})]}),Object(g.jsx)(o.c,{"onClick":function onClick(){return M(!1)},"block":!0,"children":"关闭"})]})})]})}}}]);